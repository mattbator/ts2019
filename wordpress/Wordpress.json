{"status":{},"spec":{"description":"Creation of the VMS that are needed for teh LEAP: DR RunBook workshop","resources":{"client_attrs":{"6c528ee8_deployment":{"y":322,"x":602.5},"26d0050d_deployment":{"y":320,"x":816.5}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e3bab1d4_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"884f84b6_runbook","main_task_local_reference":{"kind":"app_task","name":"e3bab1d4_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cac5d35c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"08645096_runbook","main_task_local_reference":{"kind":"app_task","name":"cac5d35c_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b50e4acd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"cf5901cd_runbook","main_task_local_reference":{"kind":"app_task","name":"b50e4acd_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f2a35a48_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4a20ea90_runbook","main_task_local_reference":{"kind":"app_task","name":"f2a35a48_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4f096e98_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d698e318_runbook","main_task_local_reference":{"kind":"app_task","name":"4f096e98_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"DB_Part"}],"name":"WebServer_Part","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"db7dcd14_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"127f8950_runbook","main_task_local_reference":{"kind":"app_task","name":"db7dcd14_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4325267d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"32d2d9f6_runbook","main_task_local_reference":{"kind":"app_task","name":"4325267d_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"74d3ff9c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b757c502_runbook","main_task_local_reference":{"kind":"app_task","name":"74d3ff9c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c2b9a363_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5390120b_runbook","main_task_local_reference":{"kind":"app_task","name":"c2b9a363_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"13e5f1f2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2ca5dc35_runbook","main_task_local_reference":{"kind":"app_task","name":"13e5f1f2_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"DB_Part","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServer","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"@@{User_initials}@@-@@{DRWebServer_Name}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[{"ip":"@@{DRWeb_IP}@@","type":"ASSIGNED"}],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"2e875c25-302d-4ecf-b7c9-5d59ce1e5665"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7.qcow2","uuid":"a6dd9e7d-dd8a-48f4-aa4d-2605d9cdb6ab"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"DBServer","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"@@{User_initials}@@-@@{DRDBServer_Name}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[{"ip":"@@{DRDB_IP}@@","type":"ASSIGNED"}],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"2e875c25-302d-4ecf-b7c9-5d59ce1e5665"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7.qcow2","uuid":"a6dd9e7d-dd8a-48f4-aa4d-2605d9cdb6ab"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS"}],"package_definition_list":[{"description":"CentOS 7 Downloadable qcow2 disk image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CENTOS_7_CLOUD","version":"","options":{"type":"","name":"CENTOS_7_CLOUD","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer_Part"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install_WebServer"}],"name":"c0644f9f_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer_Part"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install_WebServer","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Update the OS\nyum -y update\n\n# Set the right hostname\nhostnamectl set-hostname @@{DRWebServer_Name}@@\n\n# Disabling and stopping the firewall daemon\nsystemctl disable firewalld\nsystemctl stop firewalld\n\n# Turning SELinux of\nsetenforce 0\nsed -i 's\/enforcing\/disabled\/g' \/etc\/selinux\/config\n\n# Install teh Apache server and he unzip package\nyum install -y httpd unzip\n\n# Starting the Apache server and make it also start at boot time\nsystemctl start httpd\nsystemctl enable httpd\n\n# Installing the needed PHP 7.2 modules and extensions\nrpm -Uvh http:\/\/rpms.remirepo.net\/enterprise\/remi-release-7.rpm\nyum install -y yum-utils\nyum-config-manager --enable remi-php72\nyum install -y php php-cli php-mbstring php-gd php-mysqlnd php-xmlrpc php-xml php-zip php-curl\n\n# Installing MariaDB part and making it start now and at boot time\nyum install -y mariadb mariadb-server\nsystemctl start mariadb\nsystemctl enable mariadb\n\n# Have MariaDB to listen to all nics in the system and restart the MariaDB\nsed -i '\/\\[mysqld\\]\/a bind-address=0.0.0.0' \/etc\/my.cnf.d\/server.cnf\nsystemctl restart mariadb\n\n# Wordpress download, \"install\" and configure the backend\ncurl https:\/\/wordpress.org\/latest.zip -o wordpress.zip\nunzip -d \/var\/www\/html\/ wordpress.zip\nchown apache:apache -R \/var\/www\/html\/wordpress\/\nmv \/var\/www\/html\/wordpress\/wp-config-sample.php \/var\/www\/html\/wordpress\/wp-config.php\n\n# Changing the wp-config.php so it holds the correct information for teh DB server\nsed -i 's\/database_name_here\/wpdb\/g' \/var\/www\/html\/wordpress\/wp-config.php\nsed -i 's\/username_here\/wpuser\/g' \/var\/www\/html\/wordpress\/wp-config.php\nsed -i 's\/password_here\/techsummit\/g' \/var\/www\/html\/wordpress\/wp-config.php\nsed -i 's\/localhost\/@@{DRDBServer_Name}@@.ntnxlab.local\/g' \/var\/www\/html\/wordpress\/wp-config.php\necho \"define( 'WP_HOME', 'http:\/\/@@{DRWebServer_Name}@@.ntnxlab.local' );\" >> \/var\/www\/html\/wordpress\/wp-config.php\necho \"define( 'WP_SITEURL', 'http:\/\/@@{DRWebServer_Name}@@.ntnxlab.local' );\" >> \/var\/www\/html\/wordpress\/wp-config.php\n\n# Set the Worpress configuration for Apache\necho \"\n<VirtualHost *:80>\n  ServerAdmin admin@your-domain.com\n  DocumentRoot \/var\/www\/html\/wordpress\n  ServerName @@{DRWebServer_Name}@@.ntnxlab.local\n  ServerAlias @@{DRWebServer_Name}@@.ntnxlab.local\n\n  Alias \/matomo \"\/var\/www\/html\/wordpress\/\"\n  <Directory \/var\/www\/html\/wordpress\/>\n  Options +FollowSymlinks\n  AllowOverride All\n\n  <\/Directory>\n\n  ErrorLog \/var\/log\/httpd\/wordpress-error_log\n  CustomLog \/var\/log\/httpd\/wordpress-access_log common\n<\/VirtualHost>\" | sudo tee \/etc\/httpd\/conf.d\/wordpress.conf\n\n# Restart the Apache webserver\nsystemctl restart httpd\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6246b423_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"c0644f9f_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"2f62a1e4_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"45a635d0_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"2f62a1e4_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"DB_Part"}],"name":"Package3","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install MySQL"}],"name":"8cffa8ca_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DB_Part"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install MySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Update the OS\nyum -y update\n\n# Set the right hostname\nhostnamectl set-hostname @@{DRWebServer_Name}@@\n\n# Disabling and stopping the firewall daemon\nsystemctl disable firewalld\nsystemctl stop firewalld\n\n# Turning SELinux of\nsetenforce 0\nsed -i 's\/enforcing\/disabled\/g' \/etc\/selinux\/config\n\n# Install the MySQL server and the unzip package\nyum install -y mariadb mariadb-server unzip\n\n# Start the MariaDB database now and at boot time\nsystemctl start mariadb\nsystemctl enable mariadb\n\n# Configuring the database\nmysql -u root<<-EOF\n        CREATE DATABASE wpdb;\n        CREATE USER 'wpuser'@'localhost' IDENTIFIED BY 'techsummit';\n        CREATE USER 'wpuser'@'@@{DRWeb_IP}@@' IDENTIFIED BY 'techsummit';\n        CREATE USER 'wpuser'@'@@{DRWeb2_IP}@@' IDENTIFIED BY 'techsummit';\n        GRANT ALL PRIVILEGES ON wpdb.* TO 'wpuser'@'localhost';\n        GRANT ALL PRIVILEGES ON wpdb.* TO 'wpuser'@'@@{DRWeb_IP}@@';\n        GRANT ALL PRIVILEGES ON wpdb.* TO 'wpuser'@'@@{DRWeb2_IP}@@';\n        FLUSH PRIVILEGES;\nEOF\n\n# Have the MySQL server listen on all IPs and restart the MySQL server\nsed -i '\/\\[mysqld\\]\/a bind-address=0.0.0.0' \/etc\/my.cnf.d\/server.cnf\nsystemctl restart mariadb\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"9d532e34_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8cffa8ca_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"f76658e0_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a0142785_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"f76658e0_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"6c528ee8_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServer"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"26d0050d_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package3"}],"substrate_local_reference":{"kind":"app_substrate","name":"DBServer"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","description":"","name":"DRWebServer_Name","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DRWeb_IP","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DRWeb2_IP","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DRDBServer_Name","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"DRDB_IP","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}},{"val_type":"STRING","description":"","name":"User_initials","type":"LOCAL","value":"","label":"","attrs":{"type":""},"editables":{"value":true}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"jnc-Wordpress"},"api_version":"3.0","metadata":{"last_update_time":"1548786139332936","kind":"blueprint","spec_version":2,"creation_time":"1548786094974095","name":"jnc-Wordpress"}}